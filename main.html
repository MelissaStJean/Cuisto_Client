<!DOCTYPE html>
<html lang="fr-FR">

    <head>
        <meta charset="UTF-8">
        <meta author="Mélissa St-Jean & Alexandre Tardif">
        <meta http-equiv="Content-Type" content="text/html; charset= ISO-8859-1">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Chez Mel</title>

        <!---STYLES BUNDLE -------------------------------------------------------------------------->
        <link rel="stylesheet" href="css/Cuisto.css">

        <!-- Use bootstrap icon -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <!-- Confirm dialog styles -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.css">
        <!-- Font awesome styles -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <!-- Script Jquery -->
        <script
        src="https://code.jquery.com/jquery-3.6.0.js"
        integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
        crossorigin="anonymous"></script>

        <script src="js/WebAPIRequest.js"></script>

        <link rel="icon" href="favicon.ico">
    </head>
    <body>
        <div class="h_iframe">
            <iframe src="header.html"></iframe>
        </div>
        <div id="Panel">
            <text id="TextAccount">Mon compte</text>
            <div style="margin-left:10px;text-align:left;">
                <div id="avatarContainer"></div>
                <h4 id="username">non connecté</h4>
            </div>
            <div class="dash"></div>
            <div class="open-btn">
                <button class="button" onclick='openForm("dialog-loginForm")'><strong>Se connecter</strong></button> <h3>ou</h3>
                <button class="button" onclick='openForm("popupCreateForm")'><strong>S'inscrire</strong></button>
            </div>
            <text id="TextAccount">Mes outils</text>
            <div class="dash"></div>
            <br>
            <br>
            <div style="display: inline-block;">
                <table>
                    <tr>
                        <td>
                            <div style="width: 400px;">
                                <text id="TextAccount">Mon frigo</text>
                                <h5 style="margin-left:1vw; margin-right: 20px; text-align: justify;">C'est un outil permettant d'éviter le gaspillage alimentaire. Le but est simple : Sélectionnez les aliments et trouvez une recette.</h5>
                                <button type="button" class="button" onclick='changePage("frigo")'><strong>Accéder à mon frigo</strong></button> 
                                <br>
                                <br>
                            </div> 
                        </td>
                        <td>
                            <div style="width: 400px;">
                                <text id="TextAccount">Aide-moi</text>
                                <h5 style="margin-left:1vw; text-align: justify;">C'est un outil qui aide à répondre à la fameuse question "On mange quoi?"</h5>
                                <button type="button" class="button" onclick='changePage("AideMoi")'><strong>Aide-moi</strong></button>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
        </div>

        <!--Pop-up connection -->    
        <div class="login-popup">
            <div class="form-popup" id="dialog-loginForm" title="Connexion">
              <form class="form-container">
                <div>
                    <button id="cancelButton" type="button" class="btn cancel" onclick='closeForm("dialog-loginForm")'>X</button>
                </div>
                <h2 style="margin-top: 5px">Connectez-vous</h2>
                <label for="email">
                <strong>E-mail</strong>
                </label>
                <input type="text" id="loginEmail" placeholder="Votre Email" name="email" required>
                <label for="psw">
                <strong>Mot de passe</strong>
                </label>
                <input type="password" id="loginPsw" placeholder="Votre Mot de passe" name="psw" required>
                <!--<div class="form-group form-check">
                    <input type="checkbox" class="form-check-input" id="remember-me">
                    <label class="form-check-label" for="remember-me">Se souvenir de moi</label>
                </div>-->
                <br>
                <button onclick="Login()" type="submit" class="btn">Connecter</button>
              </form>
            </div>
        </div>

        <!--Pop-up création compte-->
        <div class="create-popup">
            <div class="form-popup" id="popupCreateForm">
              <form action="/action_page.php" class="form-container">
                <button id="cancelButton" type="button" class="btn cancel" onclick='closeForm("popupCreateForm")'>X</button>
                <h2 style="margin-top: 5px">Créer un compte</h2>
                <label for="name"><strong>Nom</strong></label>
                <input type="text" id="createUsername" placeholder="Votre nom"  required>
                <label for="email"><strong>E-mail</strong></label>
                <input type="text" id="createEmail" placeholder="Votre email" required>
                <label for="psw"><strong>Mot de passe</strong></label>
                <input type="password" id="createPassword" placeholder="Votre mot de passe" required>

                <div style="vertical-align:top; text-align: center ">
                    <div class='NewsDownloader' id='avatar' defaultImageSrc='./../images/No_Avatar.png'></div>
                    <label>(cliquez pour changer l'avatar)</label>
                </div>
                <br>
                <button type="submit" class="btn">Connecter</button>
              </form>
            </div>
        </div>
        <!--Les catégories
        <div class="blocCategory" id="category">
            <div style="margin-left: 10vw;">
                <p>5 ingrédients et –</p>
                <p>Rapide & efficace</p>
                <p>Les classiques </p>
                <p>Prêt à congeler</p>
                <p>Sans cuisson</p>
            </div>
        </div>-->
    </body>

    <script>
        function openForm(id) {
            document.getElementById(id).style.display="block";
        }
      
        function closeForm(id) {
            document.getElementById(id).style.display="none";
        }

        function showCategory(id){
            document.getElementById(id).style.display="block";
        }
        function changePage(name){
            document.location.href = name + ".html";
        }

        function Login(){
            webAPI_login($("#loginEmail").val(),$("#loginPsw").val(),updateUI(),failLogin());
        }
        function failLogin() {
            console.log("Login failed")
            Alert("Connexion échouée");
            connected = false;
            unsetUsername();
            updateUI();
        }

        function Alert(message) {
            $.confirm({
                title: message,
                content: '',
                buttons: {
                    fermer: function () { }
                }
            });
        }

        function unsetUsername() {
            $("#username").html("<span style='color:white'>non connecté</span>");
        }

        function setUsername(username) {
            $("#username").html("<span style='color:white;'>" + username + "</span>");
        }

        function updateUI() {
            console.log("Update d'UI")
            let username = "";
            if (retrieveLoggedUser() != null) {
                username = retrieveLoggedUser().Name;
                connected = true;
            }
            setUsername(username);
        }
    </script>
</html>